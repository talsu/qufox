#!/usr/bin/env node
var util = require('util');
var debug = require('debug')('qufox');
var config = require('../config');
var QufoxServer = require('../QufoxServer').QufoxServer;

var command = require('optimist')
	.usage('Usage : $0 --port [num] --redisurl [url] --instance [num] --single --socketonly --debug')
	.alias('p', 'port')
	.alias('r', 'redisurl')
	.alias('w', 'websocket')
	.check(function (argv){
		if (argv.p && isNaN(argv.p)){
			throw 'port must be Number.'
		}		
	});

config.servicePort = process.env.PORT || command.argv.p || Number(config.servicePort) || 3000;
config.redisUrl = process.env.REDISCLOUD_URL || command.argv.r || config.redisUrl || false;
config.websocket = command.argv.w || config.websocket || true;

debug('Qufox server starting with options ' + util.inspect(config));

var transports = config.websocket ? ['websocket', 'polling'] : ['polling'];

new QufoxServer(config.servicePort, {transports:transports}, config.redisUrl);
